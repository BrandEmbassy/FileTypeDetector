#!/usr/bin/php
<?php
require __DIR__.'/../vendor/autoload.php';

use wapmorgan\FileTypeDetector\Detector;

if ($argc == 1)
    die('Specify file names to perform detection');

function performDetection($filename) {
    if (!is_readable($filename)) return;
    $type_ext = Detector::detectByFilename($filename);
    $type_bin = Detector::detectByContent($filename);
    fwrite(STDOUT, PHP_EOL);
    echo sprintf('%54s | %-20s | %-20s', basename($filename), $type_ext === false ? 'fail' : $type_ext[0].'/'.$type_ext[1], $type_bin === false ? 'fail' : $type_bin[0].'/'.$type_bin[1]);
}

array_shift($argv);
echo sprintf('%54s | %-20s | %-20s', 'File name', 'By extension', 'By content').PHP_EOL;
foreach ($argv as $arg) {
    if (strpos($arg, '*')) {
        foreach (glob($arg) as $f) {
            if (is_file($f))
                performDetection($f);
        }
    } else if (is_dir($arg)) {
        foreach (glob(rtrim($arg, DIRECTORY_SEPARATOR).DIRECTORY_SEPARATOR.'*') as $f) {
            if (is_file($f))
                performDetection($f);
        }
    } else if (is_file($arg))
        performDetection($arg);
}
